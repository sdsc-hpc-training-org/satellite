ServerSignature off
ServerTokens Prod

# Global proxy config, mostly for rewriting absolute urls
# proxy_http config
ProxyHTMLLinks  a               href
ProxyHTMLLinks  area            href
ProxyHTMLLinks  link            href
ProxyHTMLLinks  img             src longdesc usemap
ProxyHTMLLinks  object          classid codebase data usemap
ProxyHTMLLinks  q               cite
ProxyHTMLLinks  blockquote      cite
ProxyHTMLLinks  ins             cite
ProxyHTMLLinks  del             cite
ProxyHTMLLinks  form            action
ProxyHTMLLinks  input           src usemap
ProxyHTMLLinks  head            profile
ProxyHTMLLinks  base            href
ProxyHTMLLinks  script          src for

ProxyHTMLEvents onclick ondblclick onmousedown onmouseup \
                onmouseover onmousemove onmouseout onkeypress \
                onkeydown onkeyup onfocus onblur onload \
                onunload onsubmit onreset onselect onchange

# some envs are used by the satellite cgi scripts
PassEnv SAT_CONFIG_EXTBASENAME \
                SAT_CONFIG_TGTIPMASK \
                SAT_CONFIG_JOBSTATEIPMASK \
                SAT_CONFIG_EXTPORT \
                SAT_CONFIG_TTL_SECS

# global tls config
#Listen 443
SSLSessionCache         shmcb:/run/httpd/sslcache(512000)
SSLSessionCacheTimeout  300
SSLRandomSeed startup file:/dev/urandom  256
SSLRandomSeed connect builtin
SSLCryptoDevice builtin
SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
SSLCipherSuite ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES256-GCM-SHA384:ECDH-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256
SSLCertificateFile /var/secrets/http-server.pem
SSLCertificateKeyFile /var/secrets/http-server.privkey
SSLCertificateChainFile /var/secrets/http-server.chain

<VirtualHost *:443>
  DocumentRoot /var/www/satellite/html
  ErrorLog ${APACHE_LOG_DIR}/manage.${SAT_CONFIG_EXTBASENAME}-error.log
  CustomLog ${APACHE_LOG_DIR}/manage.${SAT_CONFIG_EXTBASENAME}-access.log combined
  DirectoryIndex index.cgi
  SSLEngine on
  ServerName manage.${SAT_CONFIG_EXTBASENAME}
  <Directory "/var/www/satellite/cgi">
    SSLOptions +StdEnvVars 
    Options ExecCGI
  </Directory>

  Alias "/css"    "/var/www/satellite/html/css"
  Alias "/images" "/var/www/satellite/html/images"
  Alias "/static" "/var/www/satellite/html/static"
  ScriptAlias  "/" "/var/www/satellite/cgi/"


</VirtualHost>

# These files get rewritten when satellite/bin/cron runs
IncludeOptional /var/secrets/proxyconf.conf
